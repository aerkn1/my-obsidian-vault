flowchart TD
  subgraph ING[Ingest]
    direction TB
    OHI["OHLCV-Ingestor (realtime)\nInputs: aggTrade WS (Binance â†’ OKX FO)\nProcess: 1m bars; 1s footprint\nWrites: raw_bars, footprint_1s\nEmits: price_updates.SYMBOL.1m"]:::svc
    MI["Metric-Ingestor (15s)\nInputs: funding, OI REST/WS; tick sides (for CVD)\nProcess: cvd_delta per 15s\nWrites: metric_15s\nEmits: metric_updates.SYMBOL.15s"]:::svc
    LOB["LOB-Sampler (1s, optional)\nInputs: depth@100ms WS\nProcess: sum top1/top10 depth\nWrites: lob_1s\nEmits: lob.snap.SYMBOL.1s"]:::svc
  end
  TS["TimescaleDB\nraw_bars, footprint_1s,\nmetric_15s, lob_1s"]:::db
  RMQ["RabbitMQ\ntrading.bus"]:::bus

  OHI -->|"raw_bars, footprint_1s"| TS
  OHI -->|"price_updates.SYMBOL.1m"| RMQ
  MI  -->|"metric_15s"| TS
  MI  -->|"metric_updates.SYMBOL.15s"| RMQ
  LOB -->|"lob_1s"| TS
  LOB -->|"lob.snap.SYMBOL.1s"| RMQ

classDef svc fill:#0ea5e9,stroke:#0369a1,stroke-width:2px,color:#ffffff;
classDef model fill:#22c55e,stroke:#15803d,stroke-width:2px,color:#ffffff;
classDef db fill:#f59e0b,stroke:#b45309,stroke-width:2px,color:#111111;
classDef bus fill:#f43f5e,stroke:#be123c,stroke-width:2px,color:#ffffff;
classDef cache fill:#a78bfa,stroke:#7c3aed,stroke-width:2px,color:#ffffff;
classDef storage fill:#f97316,stroke:#9a3412,stroke-width:2px,color:#111111;
classDef api fill:#64748b,stroke:#334155,stroke-width:2px,color:#ffffff;
classDef overlay fill:#14b8a6,stroke:#0f766e,stroke-width:2px,color:#ffffff;
classDef ops fill:#94a3b8,stroke:#475569,stroke-width:2px,color:#111111;
classDef user fill:#e2e8f0,stroke:#64748b,stroke-width:2px,color:#111111;
linkStyle default stroke-width:1.6px

